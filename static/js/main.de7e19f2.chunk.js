(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,n){e.exports=n(37)},30:function(e,t,n){},31:function(e){e.exports={}},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(11),s=(n(36),n(12)),o=(n(28),n(1)),u=n.n(o),c=n(2),f=n(3),d=n(4),h=n(7),l=n(5),p=n(6),m=(n(30),n(9)),g=(n(31),n(32),function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={secondsPerPixel:.02},n.resize=n.resize.bind(Object(m.a)(n)),n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.audioBuffer&&this.renderCanvas(),window.addEventListener("resize",this.resize);var t=this.workerScript.textContent,n=new window.Blob([t],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(n),this.worker=new window.Worker(this.workerUrl),this.ctx=this.canvas.getContext("2d"),this.worker.onmessage=function(t){var n=new window.ImageData(new Uint8ClampedArray(t.data.buffer),t.data.width,t.data.height);e.canvas.width=t.data.width,e.canvas.height=t.data.height,e.ctx.putImageData(n,0,0)}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize),this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)}},{key:"renderCanvas",value:function(){var e=Object(c.a)(u.a.mark(function e(){var t,n,a,r,i,s,o,f,d,h=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.ceil(this.props.audioBuffer?this.props.audioBuffer.duration/this.state.secondsPerPixel:0),1024,n=new window.OfflineAudioContext(2,this.props.audioBuffer.length,this.props.audioBuffer.sampleRate),(a=n.createBufferSource()).buffer=this.props.audioBuffer,(r=n.createAnalyser()).fftSize=2048,r.smoothingTimeConstant=0,a.connect(r),r.connect(n.destination),a.start(),i=Array.from({length:t},function(e,t){return h.state.secondsPerPixel*t}),s=i.map(function(){var e=Object(c.a)(u.a.mark(function e(t){var a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.suspend(t);case 2:return a=new Uint8Array(r.frequencyBinCount),r.getByteFrequencyData(a),e.next=6,n.resume();case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o=n.startRendering(),e.next=16,Promise.all(s);case 16:return f=e.sent,d=f.map(function(e){return e.buffer}),this.worker.postMessage(d,d),console.log("message posted"),e.next=22,o;case 22:return e.abrupt("return");case 31:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resize",value:function(){this.props.audioBuffer&&this.forceUpdate()}},{key:"render",value:function(){var e=this,t=Math.min(this.ctx?Math.max(this.props.currentTime/this.state.secondsPerPixel-this.ctx.canvas.parentElement.clientWidth/2,0):0,this.ctx?this.props.audioBuffer.duration/this.state.secondsPerPixel-this.ctx.canvas.parentElement.clientWidth:0);return r.a.createElement("div",{className:"timeline"},r.a.createElement("div",{className:"frequencygraph"},r.a.createElement("canvas",{ref:function(t){e.canvas=t},style:{marginLeft:-t}}),r.a.createElement("div",{className:"timelinepointer",style:{left:this.props.currentTime/this.state.secondsPerPixel-t}})),r.a.createElement("script",{ref:function(t){e.workerScript=t}},'\n        const gradient = [ [0,0,0], [0,0,1], [0,0,3], [0,0,4], [0,0,6], [0,0,7], [0,0,9], [0,0,10], [0,0,12], [0,0,13], [0,0,15], [0,0,16], [0,0,18], [0,0,19], [0,0,21], [0,0,22], [0,0,24], [0,0,25], [0,0,26], [0,0,28], [0,0,29], [0,0,31], [0,0,32], [0,0,34], [0,0,35], [0,0,37], [0,0,38], [0,0,40], [0,0,41], [0,0,43], [0,0,44], [0,0,46], [0,0,47], [0,0,49], [0,0,50], [0,0,51], [0,0,53], [0,0,54], [0,0,56], [0,0,57], [0,0,59], [0,0,60], [0,0,62], [0,0,63], [0,0,65], [0,0,66], [0,0,68], [0,0,69], [0,0,71], [0,0,72], [0,0,74], [0,0,75], [0,0,76], [0,0,78], [0,0,79], [0,0,81], [0,0,82], [0,0,84], [0,0,85], [0,0,87], [0,0,88], [0,0,90], [0,0,91], [0,0,93], [0,0,94], [0,0,96], [0,0,97], [0,0,99], [0,0,100], [2,0,101], [4,0,101], [6,0,102], [8,0,102], [10,0,103], [11,0,103], [13,0,104], [15,0,104], [17,0,105], [19,0,105], [21,0,106], [23,0,106], [25,0,107], [27,0,107], [29,0,108], [30,0,108], [32,0,109], [34,0,110], [36,0,110], [38,0,111], [40,0,111], [42,0,112], [44,0,112], [46,0,113], [48,0,113], [49,0,114], [51,0,114], [53,0,115], [57,0,116], [59,0,116], [61,0,117], [63,0,118], [65,0,118], [67,0,119], [68,0,119], [70,0,120], [72,0,120], [74,0,121], [76,0,121], [78,0,122], [80,0,122], [82,0,123], [84,0,123], [86,0,124], [87,0,124], [89,0,125], [91,0,125], [93,0,126], [95,0,127], [97,0,127], [99,0,128], [101,0,128], [103,0,129], [105,0,129], [106,0,130], [108,0,130], [110,0,131], [112,0,131], [114,0,132], [116,0,132], [118,0,133], [120,0,133], [122,0,134], [124,0,135], [125,0,135], [127,0,136], [129,0,136], [131,0,137], [133,0,137], [135,0,138], [137,0,138], [139,0,139], [141,0,139], [143,0,140], [144,0,140], [146,0,141], [148,0,141], [150,0,142], [152,0,142], [154,0,143], [156,4,142], [158,8,142], [160,11,141], [162,15,141], [165,19,140], [165,19,140], [167,23,140], [169,27,139], [171,31,139], [173,34,138], [175,38,137], [177,42,137], [179,46,136], [181,50,136], [183,53,135], [186,57,135], [188,61,134], [190,65,133], [192,69,133], [194,72,132], [194,72,132], [196,76,132], [198,80,131], [200,84,131], [202,88,130], [205,92,130], [207,95,129], [209,99,128], [211,103,128], [213,107,127], [215,111,127], [217,114,126], [219,118,126], [219,118,126], [221,122,125], [223,126,124], [226,130,124], [228,133,123], [230,137,123], [232,141,122], [234,145,122], [236,149,121], [236,149,121], [238,153,121], [240,156,120], [242,160,119], [244,164,119], [247,168,118], [249,172,118], [251,175,117], [253,179,117], [255,183,116], [255,184,119], [255,186,121], [255,187,124], [255,188,126], [255,190,129], [255,191,131], [255,192,134], [255,193,136], [255,195,139], [255,196,141], [255,197,144], [255,199,146], [255,200,149], [255,201,151], [255,203,154], [255,204,156], [255,205,159], [255,207,161], [255,208,164], [255,209,167], [255,210,169], [255,212,172], [255,213,174], [255,214,177], [255,216,179], [255,217,182], [255,218,184], [255,220,187], [255,221,189], [255,222,192], [255,224,194], [255,225,197], [255,226,199], [255,228,202], [255,229,204], [255,230,207], [255,231,210], [255,233,212], [255,234,215], [255,235,217], [255,237,220], [255,238,222], [255,239,225], [255,241,227], [255,242,230], [255,243,232], [255,245,235], [255,246,237], [255,247,240], [255,248,242], [255,250,245], [255,251,247], [255,252,250], [255,254,252], [255,255,255]]\n        let ctx = null\n        onmessage = e => {\n          if (e.data.canvas) ctx = e.data.canvas.getContext("2d")\n          else {\n            const arrays = e.data.map(buffer => new Uint8Array(buffer))\n            const width = arrays.length\n            const height = arrays[0].length\n            //ctx.canvas.width = width\n            //ctx.canvas.height = height\n            //const imageData = ctx.getImageData(0, 0, width, height)\n            const imageData = new ImageData(width, height)\n\n            const data = new Uint32Array(imageData.data.buffer)\n\n            for (let y = 0; y < height; ++y) {\n              for (let x = 0; x < width; ++x) {\n                const value = arrays[x][height - y - 1]\n                data[y * width + x] =\n                        (255 << 24) | // alpha\n                        (gradient[value][2] << 16) | // blue\n                        (gradient[value][1] << 8) | // green\n                        gradient[value][0] // red\n              }\n            }\n            //debugger\n            //ctx.putImageData(imageData, 0, 0)\n            postMessage({buffer: imageData.data.buffer, width: imageData.width, height: imageData.height}, [imageData.data.buffer])\n          }\n          console.log("we\'re good")\n        }\n      '),r.a.createElement("input",{type:"range",min:"0",max:this.props.audioBuffer?this.props.audioBuffer.duration.toString():"0",step:"0.01",value:this.props.currentTime,onInput:this.props.onCurrentTimeChange,onChange:function(){}}))}}]),t}(a.PureComponent)),v=(n(33),function(e){function t(){return Object(f.a)(this,t),Object(h.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"playpause"},r.a.createElement("button",{onClick:this.props.onChange,disabled:this.props.disabled},this.props.isPlaying?"Pause":"Play"))}}]),t}(a.PureComponent)),y=(n(34),function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={isWorking:!1},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"audioopener"},r.a.createElement("input",{type:"file",id:"input",accept:"audio/*",onChange:function(t){return e.openFile(t)},disabled:this.state.isWorking}))}},{key:"openFile",value:function(e){var t=this;if(e.target.files.length){this.setState({isWorking:!0});var n=new window.FileReader;n.onload=function(){var e=Object(c.a)(u.a.mark(function e(n){var a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.audioContext.decodeAudioData(n.target.result);case 2:a=e.sent,t.setState({isWorking:!1}),t.props.onOpen(a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.readAsArrayBuffer(e.target.files[0])}}}]),t}(a.PureComponent));n(35);var w=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={audioBuffer:null,audioBufferKey:0,currentTime:0,startTime:0,isPlaying:!1},n.audioContext=new window.AudioContext,n.sourceNode=null,n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"player"},r.a.createElement(g,{audioBuffer:this.state.audioBuffer,currentTime:this.state.currentTime,onCurrentTimeChange:function(t){return e.currentTimeChanged(+t.target.value)},key:this.state.audioBufferKey}),r.a.createElement(v,{isPlaying:this.state.isPlaying,onChange:this.state.isPlaying?function(){return e.pause()}:function(){return e.play()},disabled:!this.state.audioBuffer}),r.a.createElement(y,{audioContext:this.audioContext,onOpen:function(t){e.fileOpened(t),e.play()}}))}},{key:"fileOpened",value:function(e){var t=this;this.setState(function(n){return{audioBuffer:e,audioBufferKey:n.audioBufferKey+1,currentTime:0,startTime:t.audioContext.currentTime}},function(){t.state.isPlaying&&t.play()})}},{key:"play",value:function(){var e=Object(c.a)(u.a.mark(function e(){var t,n=this,a=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:this.state.currentTime,this.state.audioBuffer){e.next=3;break}return e.abrupt("return");case 3:if("suspended"!==this.audioContext.state){e.next=6;break}return e.next=6,this.audioContext.resume();case 6:this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode.stop()),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.connect(this.audioContext.destination),this.sourceNode.buffer=this.state.audioBuffer,this.sourceNode.start(0,t),this.state.isPlaying||window.requestAnimationFrame(function(){return n.updateCurrentTime()}),this.setState({isPlaying:!0,startTime:this.audioContext.currentTime-t});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateCurrentTime",value:function(){var e=this;this.setState(function(t){return e.state.isPlaying?{currentTime:e.audioContext.currentTime-t.startTime}:{}},function(){return e.state.isPlaying&&window.requestAnimationFrame(function(){return e.updateCurrentTime()})})}},{key:"pause",value:function(){var e=Object(c.a)(u.a.mark(function e(){var t=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sourceNode.disconnect(),this.sourceNode.stop(),this.sourceNode=null,this.setState(function(e){return{isPlaying:!1,currentTime:t.audioContext.currentTime-e.startTime}});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"currentTimeChanged",value:function(e){this.state.isPlaying?this.play(e):this.setState({currentTime:e})}}]),t}(a.PureComponent),x=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).audioContext=new AudioContext,n.filter=n.audioContext.createBiquadFilter(),n.state={working:!1,audioBuffer:null},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(w,null))}},{key:"openFile",value:function(e){var t=this;if(e.target.files.length){this.setState({working:!0});var n=new window.FileReader;n.onload=function(){var e=Object(c.a)(u.a.mark(function e(n){var a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.audioContext.decodeAudioData(n.target.result);case 2:a=e.sent,t.source=t.audioContext.createBufferSource(),t.source.buffer=a,t.source.connect(t.filter),t.filter.connect(t.audioContext.destination),t.play(),t.setState({working:!1});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.readAsArrayBuffer(e.target.files[0])}}},{key:"play",value:function(){var e=Object(c.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(this.audioContext.state),"suspended"!==this.audioContext.state){e.next=5;break}return e.next=4,this.audioContext.resume();case 4:console.log("resumed");case 5:this.source.start(0),console.log("started");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(a.Component);window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.b;Object(i.render)(r.a.createElement(a.StrictMode,null,r.a.createElement(x,null)),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.de7e19f2.chunk.js.map